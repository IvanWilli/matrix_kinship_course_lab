---
title: "Matrix Approaches to Modelling Kinship Theory and Applications"
subtitle: "IDEM 128 - Computer lab exercises"
# author: "iw_da"
date: "Update: `r Sys.Date()`"
output:
  html_document:
    # toc_depth: 2
    toc_float: true
    # number_sections: true
    theme: readable
    highlight: pygments
    # code_folding: hide
bibliography: kinship.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## {.tabset}

### Introduction

This guide pretends to give you some practical tools for applying the theory on your own specific research goals. In each day we will have a time for learn how to code in R some key matrix forms and get basic results. In a second part we will use DemoKin package for speeding up the pathway between ideas/questions and results. With the first part you will have a notion of what is happening when you run functions in the second part, so you can customize your code for your own purpose if is necessary.

For the next 10 days we are kind of course-related-non biological-family, so brother/sister: please reach us for any doubt.

We hope you enjoy it and be helpful. Hands on.

Hal, Diego and Iván.

<!-- --------------------------------------------------------------------- -->

### Wed 3

#### Initial settings

We will start tomorrow the computer lab, but would be great if in advance we have prepared R environment. Firs, you will need R and Rstudio installed.

Install the [development version from GitHub](https://github.com/IvanWilli/DemoKin) (could take ~1 minute). We made changes to the `DemoKin` package ahead of this workshop If you had already installed the package, please uninstall it and and install it again.

```{r, eval=FALSE}
# remove.packages("DemoKin")
# install.packages("devtools")
devtools::install_github("IvanWilli/DemoKin", build_vignettes = TRUE)
```

Other packages that will be useful are:

```{r, eval=FALSE}
packages_needed <- c("tidyverse", "HMDHFDplus", "matrixcalc", "Matrix") 
packages_needed_nothaving <- packages_needed[!packages_needed %in% installed.packages()
for(lib in packages_needed_nothaving) install.packages(lib,dependencies=TRUE)
```

Load all those libraries and you should receive no error. Please contact us in case some issues come up with this topic.

<!-- --------------------------------------------------------------------- -->

### Thurs 4

#### Matrix population models

In this section...

##### R-clues

...

##### Practice

...

<!-- --------------------------------------------------------------------- -->

### Mon 8

#### Age-classified time-invariant one-sex kinship models

In this section...

##### R-clues

Imagine you are studying a female population with 5 ages (from 0 to 4) and fixed survival probabilities and fertility rates, given by:

```{r}
age <- 0:4
p <- c(.9, .7, .4, .1, 0)
m <- c(0, .2, .5, .3, 0)
```

Let´s build the transition matrix $U$ and $f$. The fertility transition matrix should be a capitol letter but R has this letter reserved.

```{r}
ages = length(age)
U = f = matrix(0, nrow=ages, ncol=ages)
U[row(U)-1 == col(U)] <- p[-ages]
U[ages, ages] = p[ages]
f[1,] = m
```

Now find eigenvalues and eigenvectors for having the stable distribution by age $w$, and then the ones for mothers $pi$.

```{r}
A = U + f
A_eigen = eigen(A)
A_eigen_value = as.double(A_eigen$values[1])
A_eigen_vector = as.double(A_eigen$vectors[,1])
w = A_eigen_vector/sum(A_eigen_vector)
pi = w*m/sum(w*m)
```

Let´s focus in the mother.  

```{r}
e = diag(1, ages)
```

##### Using DemoKin

Let´s see how to solve exercise 1 with DemoKin.

1. Project the pop... [@caswell_formal_2019]

2. Give a value for...

3. Focal lives in...

##### Practice

3. Imagine a world where...

<!-- --------------------------------------------------------------------- -->

### Tues 9

#### Age-classified time-variant one-sex kinship models

In this section...

##### R-clues

1. Project the pop...

##### Using DemoKin

Let´s see how to solve exercise 1 with DemoKin.

1. Project the pop...

2. Give a value for...

3. Focal lives in...

##### Practice

3. Imagine a world where...

<!-- --------------------------------------------------------------------- -->

### Wed 10

#### Age-classified time-invariant two-sex kinship models

In this section...

##### R-clues

1. Project the pop...

##### Using DemoKin

Let´s see how to solve exercise 1 with DemoKin.

1. Project the pop...

2. Give a value for...

3. Focal lives in...

##### Practice

3. Imagine a world where...

<!-- --------------------------------------------------------------------- -->

### Thurs 11

#### Multistate kinship models with applications to health

In this section...

##### R-clues

1. Project the pop...

##### Using DemoKin

Let´s see how to solve exercise 1 with DemoKin.

1. Project the pop...

2. Give a value for...

3. Focal lives in...

##### Practice

3. Imagine a world where...

<!-- --------------------------------------------------------------------- -->

### Solutions

<!-- --------------------------------------------------------------------- -->

### References

